import{f as e,A as se,r as k,l as W,b as $e,G as Fe,c,o as m,p as oe,w as n,g as x,d as _,e as u,h as O,P as ae,F as P,H as L,k as D,t as S,m as b,J as He,B as le,u as Je,i as Ge,q as be,C as Oe,M as We,Q as Xe,y as Ye,E as Ze,z as Ke,U as et}from"./index-90a1d7b0.js";import{_ as Ue}from"./_plugin-vue_export-helper-c27b6911.js";import{S as tt}from"./SaveOutlined-03c9a56b.js";import{U as nt}from"./UploadOutlined-a290c291.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};const lt=at;function ke(d){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},v=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(i).filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable}))),v.forEach(function(y){ot(d,y,i[y])})}return d}function ot(d,r,i){return r in d?Object.defineProperty(d,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):d[r]=i,d}var me=function(r,i){var v=ke({},r,i.attrs);return e(se,ke({},v,{icon:lt}),null)};me.displayName="ArrowDownOutlined";me.inheritAttrs=!1;const st=me;var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};const rt=it;function Ce(d){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},v=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(i).filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable}))),v.forEach(function(y){ut(d,y,i[y])})}return d}function ut(d,r,i){return r in d?Object.defineProperty(d,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):d[r]=i,d}var ve=function(r,i){var v=Ce({},r,i.attrs);return e(se,Ce({},v,{icon:rt}),null)};ve.displayName="ArrowUpOutlined";ve.inheritAttrs=!1;const dt=ve;var ct={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"};const pt=ct;function Se(d){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},v=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(i).filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable}))),v.forEach(function(y){mt(d,y,i[y])})}return d}function mt(d,r,i){return r in d?Object.defineProperty(d,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):d[r]=i,d}var fe=function(r,i){var v=Se({},r,i.attrs);return e(se,Se({},v,{icon:pt}),null)};fe.displayName="ImportOutlined";fe.inheritAttrs=!1;const vt=fe;var ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"};const _t=ft;function De(d){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},v=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(i).filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable}))),v.forEach(function(y){gt(d,y,i[y])})}return d}function gt(d,r,i){return r in d?Object.defineProperty(d,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):d[r]=i,d}var _e=function(r,i){var v=De({},r,i.attrs);return e(se,De({},v,{icon:_t}),null)};_e.displayName="RocketOutlined";_e.inheritAttrs=!1;const yt=_e;const wt={key:0,class:"options-section"},xt={class:"section-header"},ht={class:"options-list"},bt={class:"option-content"},Ot={class:"option-actions"},kt={key:1,class:"rating-config"},Ct={key:2,class:"matrix-config"},St={class:"matrix-section"},Dt={class:"section-header"},$t={class:"matrix-rows"},Ut={class:"matrix-section"},It={class:"section-header"},Rt={class:"matrix-columns"},qt={class:"validation-section"},Tt={class:"form-actions"},Qt={__name:"QuestionModal",props:{open:{type:Boolean,default:!1},question:{type:Object,default:null}},emits:["update:open","save"],setup(d,{emit:r}){const i=d,v=r,y=k(),E=k(!1),z=W(()=>!!i.question),B=W(()=>["single","multiple","rating"].includes(a.type)),a=$e({id:null,type:"single",title:"",description:"",required:!1,options:[],minScore:1,maxScore:5,step:1,matrixRows:[],matrixColumns:[],minLength:0,maxLength:1e3,pattern:""}),V={type:[{required:!0,message:"请选择问题类型",trigger:"change"}],title:[{required:!0,message:"请输入问题标题",trigger:"blur"},{min:2,max:200,message:"标题长度在2-200个字符之间",trigger:"blur"}],description:[{max:500,message:"描述长度不能超过500个字符",trigger:"blur"}]};Fe(()=>i.open,w=>{w&&X()});const X=()=>{i.question?Object.assign(a,{...i.question}):Object.assign(a,{id:null,type:"single",title:"",description:"",required:!1,options:[{id:Date.now(),text:"选项1"},{id:Date.now()+1,text:"选项2"}],minScore:1,maxScore:5,step:1,matrixRows:[{id:Date.now(),text:"行1"}],matrixColumns:[{id:Date.now(),text:"列1"}],minLength:0,maxLength:1e3,pattern:""})},F=w=>{["single","multiple"].includes(w)?a.options=[{id:Date.now(),text:"选项1"},{id:Date.now()+1,text:"选项2"}]:w==="rating"?a.options=[{id:Date.now(),text:"1分",value:1},{id:Date.now()+1,text:"2分",value:2},{id:Date.now()+2,text:"3分",value:3},{id:Date.now()+3,text:"4分",value:4},{id:Date.now()+4,text:"5分",value:5}]:w==="matrix"&&(a.matrixRows=[{id:Date.now(),text:"行1"}],a.matrixColumns=[{id:Date.now(),text:"列1"}])},Y=()=>{const w={id:Date.now(),text:`选项${a.options.length+1}`,value:a.type==="rating"?a.options.length+1:void 0};a.options.push(w)},Z=w=>{a.options.length>2&&a.options.splice(w,1)},K=()=>{const w={id:Date.now(),text:`行${a.matrixRows.length+1}`};a.matrixRows.push(w)},H=w=>{a.matrixRows.length>1&&a.matrixRows.splice(w,1)},h=()=>{const w={id:Date.now(),text:`列${a.matrixColumns.length+1}`};a.matrixColumns.push(w)},g=w=>{a.matrixColumns.length>1&&a.matrixColumns.splice(w,1)},J=async()=>{var w;try{if(E.value=!0,await((w=y.value)==null?void 0:w.validate()),B.value&&a.options.length<2){b.error("至少需要2个选项");return}if(a.type==="matrix"&&(a.matrixRows.length<1||a.matrixColumns.length<1)){b.error("矩阵题至少需要1行1列");return}const s={...a};v("save",s)}catch(s){console.error("保存问题失败:",s),b.error("请检查表单信息")}finally{E.value=!1}},te=()=>{v("update:open",!1),He(()=>{var w;(w=y.value)==null||w.resetFields()})},ie=w=>{v("update:open",w)};return(w,s)=>{const j=c("a-select-option"),re=c("a-select"),U=c("a-form-item"),I=c("a-col"),ue=c("a-switch"),G=c("a-row"),M=c("a-input"),de=c("a-textarea"),q=c("a-button"),N=c("a-input-number"),ce=c("a-form"),pe=c("a-modal");return m(),oe(pe,{open:d.open,title:z.value?"编辑问题":"添加问题",width:"800px",footer:null,onCancel:te,"onUpdate:open":ie},{default:n(()=>[e(ce,{model:a,rules:V,layout:"vertical",ref_key:"formRef",ref:y,onFinish:J},{default:n(()=>[e(G,{gutter:16},{default:n(()=>[e(I,{span:12},{default:n(()=>[e(U,{label:"问题类型",name:"type"},{default:n(()=>[e(re,{value:a.type,"onUpdate:value":s[0]||(s[0]=p=>a.type=p),placeholder:"请选择问题类型",size:"large",onChange:F},{default:n(()=>[e(j,{value:"single"},{default:n(()=>s[10]||(s[10]=[x("单选题",-1)])),_:1,__:[10]}),e(j,{value:"multiple"},{default:n(()=>s[11]||(s[11]=[x("多选题",-1)])),_:1,__:[11]}),e(j,{value:"text"},{default:n(()=>s[12]||(s[12]=[x("问答题",-1)])),_:1,__:[12]}),e(j,{value:"rating"},{default:n(()=>s[13]||(s[13]=[x("评分题",-1)])),_:1,__:[13]}),e(j,{value:"matrix"},{default:n(()=>s[14]||(s[14]=[x("矩阵题",-1)])),_:1,__:[14]})]),_:1},8,["value"])]),_:1})]),_:1}),e(I,{span:12},{default:n(()=>[e(U,{label:"是否必填",name:"required"},{default:n(()=>[e(ue,{checked:a.required,"onUpdate:checked":s[1]||(s[1]=p=>a.required=p),"checked-children":"必填","un-checked-children":"选填"},null,8,["checked"])]),_:1})]),_:1})]),_:1}),e(U,{label:"问题标题",name:"title"},{default:n(()=>[e(M,{value:a.title,"onUpdate:value":s[2]||(s[2]=p=>a.title=p),placeholder:"请输入问题标题",size:"large"},null,8,["value"])]),_:1}),e(U,{label:"问题描述",name:"description"},{default:n(()=>[e(de,{value:a.description,"onUpdate:value":s[3]||(s[3]=p=>a.description=p),placeholder:"请输入问题描述（可选）",rows:2},null,8,["value"])]),_:1}),B.value?(m(),_("div",wt,[u("div",xt,[s[16]||(s[16]=u("h4",null,"选项配置",-1)),e(q,{type:"dashed",onClick:Y},{default:n(()=>[e(O(ae)),s[15]||(s[15]=x(" 添加选项 ",-1))]),_:1,__:[15]})]),u("div",ht,[(m(!0),_(P,null,L(a.options,(p,T)=>(m(),_("div",{key:p.id,class:"option-item"},[u("div",bt,[e(M,{value:p.text,"onUpdate:value":R=>p.text=R,placeholder:`选项 ${T+1}`,size:"large"},null,8,["value","onUpdate:value","placeholder"]),a.type==="rating"?(m(),oe(M,{key:0,value:p.value,"onUpdate:value":R=>p.value=R,placeholder:"分值",type:"number",style:{width:"100px"}},null,8,["value","onUpdate:value"])):D("",!0)]),u("div",Ot,[e(q,{type:"text",onClick:R=>Z(T),disabled:a.options.length<=2,danger:""},{default:n(()=>[e(O(le))]),_:2},1032,["onClick","disabled"])])]))),128))])])):D("",!0),a.type==="rating"?(m(),_("div",kt,[e(G,{gutter:16},{default:n(()=>[e(I,{span:8},{default:n(()=>[e(U,{label:"最小分值",name:"minScore"},{default:n(()=>[e(N,{value:a.minScore,"onUpdate:value":s[4]||(s[4]=p=>a.minScore=p),min:0,max:a.maxScore-1,style:{width:"100%"}},null,8,["value","max"])]),_:1})]),_:1}),e(I,{span:8},{default:n(()=>[e(U,{label:"最大分值",name:"maxScore"},{default:n(()=>[e(N,{value:a.maxScore,"onUpdate:value":s[5]||(s[5]=p=>a.maxScore=p),min:a.minScore+1,max:10,style:{width:"100%"}},null,8,["value","min"])]),_:1})]),_:1}),e(I,{span:8},{default:n(()=>[e(U,{label:"步长",name:"step"},{default:n(()=>[e(N,{value:a.step,"onUpdate:value":s[6]||(s[6]=p=>a.step=p),min:.5,max:2,step:.5,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})])):D("",!0),a.type==="matrix"?(m(),_("div",Ct,[e(G,{gutter:16},{default:n(()=>[e(I,{span:12},{default:n(()=>[u("div",St,[u("div",Dt,[s[18]||(s[18]=u("h4",null,"行标题",-1)),e(q,{type:"dashed",size:"small",onClick:K},{default:n(()=>[e(O(ae)),s[17]||(s[17]=x(" 添加行 ",-1))]),_:1,__:[17]})]),u("div",$t,[(m(!0),_(P,null,L(a.matrixRows,(p,T)=>(m(),_("div",{key:p.id,class:"matrix-row"},[e(M,{value:p.text,"onUpdate:value":R=>p.text=R,placeholder:`行 ${T+1}`},null,8,["value","onUpdate:value","placeholder"]),e(q,{type:"text",onClick:R=>H(T),disabled:a.matrixRows.length<=1,danger:""},{default:n(()=>[e(O(le))]),_:2},1032,["onClick","disabled"])]))),128))])])]),_:1}),e(I,{span:12},{default:n(()=>[u("div",Ut,[u("div",It,[s[20]||(s[20]=u("h4",null,"列标题",-1)),e(q,{type:"dashed",size:"small",onClick:h},{default:n(()=>[e(O(ae)),s[19]||(s[19]=x(" 添加列 ",-1))]),_:1,__:[19]})]),u("div",Rt,[(m(!0),_(P,null,L(a.matrixColumns,(p,T)=>(m(),_("div",{key:p.id,class:"matrix-column"},[e(M,{value:p.text,"onUpdate:value":R=>p.text=R,placeholder:`列 ${T+1}`},null,8,["value","onUpdate:value","placeholder"]),e(q,{type:"text",onClick:R=>g(T),disabled:a.matrixColumns.length<=1,danger:""},{default:n(()=>[e(O(le))]),_:2},1032,["onClick","disabled"])]))),128))])])]),_:1})]),_:1})])):D("",!0),u("div",qt,[s[21]||(s[21]=u("h4",null,"验证规则",-1)),e(G,{gutter:16},{default:n(()=>[e(I,{span:8},{default:n(()=>[e(U,{label:"最小长度",name:"minLength"},{default:n(()=>[e(N,{value:a.minLength,"onUpdate:value":s[7]||(s[7]=p=>a.minLength=p),min:0,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(I,{span:8},{default:n(()=>[e(U,{label:"最大长度",name:"maxLength"},{default:n(()=>[e(N,{value:a.maxLength,"onUpdate:value":s[8]||(s[8]=p=>a.maxLength=p),min:a.minLength||0,style:{width:"100%"}},null,8,["value","min"])]),_:1})]),_:1}),e(I,{span:8},{default:n(()=>[e(U,{label:"正则验证",name:"pattern"},{default:n(()=>[e(M,{value:a.pattern,"onUpdate:value":s[9]||(s[9]=p=>a.pattern=p),placeholder:"正则表达式（可选）"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),u("div",Tt,[e(q,{onClick:te},{default:n(()=>s[22]||(s[22]=[x("取消",-1)])),_:1,__:[22]}),e(q,{type:"primary",onClick:J,loading:E.value},{default:n(()=>[x(S(z.value?"更新":"添加"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["open","title"])}}},At=Ue(Qt,[["__scopeId","data-v-41fa652f"]]);const Pt={class:"questionnaire-create"},Lt={class:"page-header"},Et={class:"header-actions"},Mt={class:"create-content"},Nt={class:"questions-list"},Vt={class:"question-header"},jt={class:"question-number"},zt={class:"question-type"},Bt={class:"question-actions"},Ft={class:"question-content"},Ht={class:"question-text"},Jt={key:0,class:"question-description"},Gt={key:1,class:"question-options"},Wt={key:0,class:"option-value"},Xt={key:2,class:"matrix-preview"},Yt={class:"matrix-rows"},Zt={class:"matrix-columns"},Kt={class:"question-footer"},en={class:"drag-handles"},tn={key:0,class:"empty-questions"},nn={class:"empty-icon"},an={class:"question-preview"},ln={class:"preview-question"},on={key:0},sn={key:1,class:"preview-options"},rn={key:2,class:"preview-options"},un={key:3,class:"preview-options"},dn={key:4,class:"preview-options"},cn={class:"rating-text"},pn={key:5,class:"preview-options"},mn={class:"import-content"},vn={__name:"QuestionnaireCreate",setup(d){const r=Je(),i=k(!1),v=k(!1),y=k(!1),E=k(null),z=k(),B=k(!1),a=k(null),V=k(!1),X=k(!1),F=k([]),Y=k(null),Z=k([]),K=k(""),H=k(0),h=$e({title:"",type:"",description:"",startTime:null,endTime:null,anonymous:!1}),g=k([]),J=W(()=>h.title.trim()&&h.type),te=W(()=>J.value&&g.value.length>0),ie={title:[{required:!0,message:"请输入问卷标题",trigger:"blur"},{min:2,max:100,message:"标题长度在2-100个字符之间",trigger:"blur"}],type:[{required:!0,message:"请选择问卷类型",trigger:"change"}],description:[{required:!0,message:"请输入问卷描述",trigger:"blur"},{min:10,max:500,message:"描述长度在10-500个字符之间",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}]},w=W(()=>{if(!a.value||a.value.type!=="matrix")return[];const l=[{title:"问题",dataIndex:"question",key:"question",width:120}];return a.value.matrixColumns&&a.value.matrixColumns.forEach((t,f)=>{l.push({title:t.text,dataIndex:`option${f}`,key:`option${f}`,width:80})}),l}),s=W(()=>{var l;return!a.value||a.value.type!=="matrix"?[]:((l=a.value.matrixRows)==null?void 0:l.map(t=>{var f;return{key:t.id,question:t.text,...(f=a.value.matrixColumns)==null?void 0:f.reduce((Q,$,A)=>(Q[`option${A}`]=null,Q),{})}}))||[]}),j=l=>et.getQuestionTypeName(l),re=l=>l&&l<new Date().setHours(0,0,0,0),U=l=>l&&l<=h.startTime,I=async()=>{var l;try{await((l=z.value)==null?void 0:l.validate()),i.value=!0;const t={...h,questions:g.value.map((Q,$)=>({...Q,order:$+1})),status:0,createTime:new Date().toISOString()},f=await be.post(Oe.API_ENDPOINTS.QUESTIONNAIRE_CREATE,t);f.code===200?(b.success("草稿保存成功"),localStorage.setItem("questionnaire_draft",JSON.stringify(t))):b.error(f.message||"保存草稿失败")}catch(t){console.error("保存草稿失败:",t),t.name==="ValidationError"?b.error("请检查表单信息"):b.error("保存草稿失败，请稍后重试")}finally{i.value=!1}},ue=async()=>{var l;try{if(await((l=z.value)==null?void 0:l.validate()),g.value.length===0){b.error("请至少添加一个问题");return}if(g.value.filter($=>!$.title.trim()).length>0){b.error("请完善所有问题的标题");return}v.value=!0;const f={...h,questions:g.value.map(($,A)=>({...$,order:A+1})),status:1,createTime:new Date().toISOString()},Q=await be.post(Oe.API_ENDPOINTS.QUESTIONNAIRE_CREATE,f);Q.code===200?(b.success("问卷发布成功"),localStorage.removeItem("questionnaire_draft"),r.push("/questionnaire/management")):b.error(Q.message||"发布问卷失败")}catch(t){console.error("发布问卷失败:",t),t.name==="ValidationError"?b.error("请检查表单信息"):b.error("发布问卷失败，请稍后重试")}finally{v.value=!1}},G=l=>{E.value={...l},y.value=!0},M=l=>{a.value=l,B.value=!0,Y.value=null,Z.value=[],K.value="",H.value=0},de=l=>{const t={...l,id:Date.now(),title:`${l.title} (副本)`};g.value.push(t),b.success("问题复制成功")},q=l=>{const t=g.value.findIndex(f=>f.id===l);t>-1&&(g.value.splice(t,1),b.success("问题删除成功"))},N=(l,t)=>{if(t==="up"&&l>0){const f=g.value[l];g.value[l]=g.value[l-1],g.value[l-1]=f}else if(t==="down"&&l<g.value.length-1){const f=g.value[l];g.value[l]=g.value[l+1],g.value[l+1]=f}},ce=l=>{if(E.value){const t=g.value.findIndex(f=>f.id===l.id);t>-1&&(g.value[t]=l,b.success("问题更新成功"))}else{const t={...l,id:Date.now()};g.value.push(t),b.success("问题添加成功")}y.value=!1,E.value=null},pe=()=>{V.value=!0},p=l=>["application/json","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(l.type)?(l.size/1024/1024<2||b.error("文件大小不能超过 2MB!"),!1):(b.error("只支持 JSON、Excel 或 CSV 文件!"),!1),T=async()=>{if(F.value.length===0){b.error("请选择要导入的文件");return}try{X.value=!0;const l=[{id:Date.now(),type:"single",title:"您对我们的服务满意吗？",description:"请选择最符合您感受的选项",required:!0,options:[{id:Date.now(),text:"非常满意"},{id:Date.now()+1,text:"满意"},{id:Date.now()+2,text:"一般"},{id:Date.now()+3,text:"不满意"}]}];g.value.push(...l),b.success("问题导入成功"),V.value=!1,F.value=[]}catch(l){console.error("导入问题失败:",l),b.error("导入失败，请检查文件格式")}finally{X.value=!1}},R=async()=>{if(J.value&&g.value.length>0)try{const l={...h,questions:g.value,status:0,lastSaveTime:new Date().toISOString()};localStorage.setItem("questionnaire_draft",JSON.stringify(l))}catch(l){console.error("自动保存失败:",l)}},Ie=()=>{try{const l=localStorage.getItem("questionnaire_draft");if(l){const t=JSON.parse(l);We.confirm({title:"发现草稿",content:"检测到未保存的草稿，是否要恢复？",onOk:()=>{Object.assign(h,t),g.value=t.questions||[],b.success("草稿已恢复")},onCancel:()=>{localStorage.removeItem("questionnaire_draft")}})}}catch(l){console.error("加载草稿失败:",l),localStorage.removeItem("questionnaire_draft")}};return Ge(()=>{h.startTime=new Date,h.endTime=new Date(Date.now()+7*24*60*60*1e3),Ie(),setInterval(R,3e4)}),(l,t)=>{const f=c("a-button"),Q=c("a-input"),$=c("a-form-item"),A=c("a-col"),ne=c("a-select-option"),Re=c("a-select"),ge=c("a-row"),ye=c("a-textarea"),we=c("a-date-picker"),qe=c("a-switch"),Te=c("a-form"),xe=c("a-card"),Qe=c("a-space"),Ae=c("a-popconfirm"),Pe=c("a-tag"),Le=c("a-empty"),Ee=c("a-radio"),Me=c("a-radio-group"),Ne=c("a-checkbox"),Ve=c("a-checkbox-group"),je=c("a-rate"),ze=c("a-table"),he=c("a-modal"),Be=c("a-upload");return m(),_("div",Pt,[u("div",Lt,[t[18]||(t[18]=u("div",{class:"header-left"},[u("h1",null,"创建问卷"),u("p",null,"设计您的问卷内容，支持多种题型")],-1)),u("div",Et,[e(f,{onClick:I,loading:i.value,disabled:!J.value},{default:n(()=>[e(O(tt)),t[16]||(t[16]=x(" 保存草稿 ",-1))]),_:1,__:[16]},8,["loading","disabled"]),e(f,{type:"primary",onClick:ue,loading:v.value,disabled:!te.value},{default:n(()=>[e(O(yt)),t[17]||(t[17]=x(" 发布问卷 ",-1))]),_:1,__:[17]},8,["loading","disabled"])])]),u("div",Mt,[e(xe,{title:"问卷基本信息",class:"info-card"},{default:n(()=>[e(Te,{model:h,rules:ie,layout:"vertical",ref_key:"infoFormRef",ref:z},{default:n(()=>[e(ge,{gutter:16},{default:n(()=>[e(A,{span:12},{default:n(()=>[e($,{label:"问卷标题",name:"title"},{default:n(()=>[e(Q,{value:h.title,"onUpdate:value":t[0]||(t[0]=o=>h.title=o),placeholder:"请输入问卷标题",size:"large",maxlength:100,"show-count":""},null,8,["value"])]),_:1})]),_:1}),e(A,{span:12},{default:n(()=>[e($,{label:"问卷类型",name:"type"},{default:n(()=>[e(Re,{value:h.type,"onUpdate:value":t[1]||(t[1]=o=>h.type=o),placeholder:"请选择问卷类型",size:"large"},{default:n(()=>[e(ne,{value:"survey"},{default:n(()=>t[19]||(t[19]=[x("调查问卷",-1)])),_:1,__:[19]}),e(ne,{value:"feedback"},{default:n(()=>t[20]||(t[20]=[x("反馈问卷",-1)])),_:1,__:[20]}),e(ne,{value:"evaluation"},{default:n(()=>t[21]||(t[21]=[x("评价问卷",-1)])),_:1,__:[21]}),e(ne,{value:"other"},{default:n(()=>t[22]||(t[22]=[x("其他",-1)])),_:1,__:[22]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e($,{label:"问卷描述",name:"description"},{default:n(()=>[e(ye,{value:h.description,"onUpdate:value":t[2]||(t[2]=o=>h.description=o),placeholder:"请输入问卷描述",rows:3,maxlength:500,"show-count":""},null,8,["value"])]),_:1}),e(ge,{gutter:16},{default:n(()=>[e(A,{span:8},{default:n(()=>[e($,{label:"开始时间",name:"startTime"},{default:n(()=>[e(we,{value:h.startTime,"onUpdate:value":t[3]||(t[3]=o=>h.startTime=o),"show-time":"",placeholder:"选择开始时间",style:{width:"100%"},"disabled-date":re},null,8,["value"])]),_:1})]),_:1}),e(A,{span:8},{default:n(()=>[e($,{label:"结束时间",name:"endTime"},{default:n(()=>[e(we,{value:h.endTime,"onUpdate:value":t[4]||(t[4]=o=>h.endTime=o),"show-time":"",placeholder:"选择结束时间",style:{width:"100%"},"disabled-date":U},null,8,["value"])]),_:1})]),_:1}),e(A,{span:8},{default:n(()=>[e($,{label:"是否匿名",name:"anonymous"},{default:n(()=>[e(qe,{checked:h.anonymous,"onUpdate:checked":t[5]||(t[5]=o=>h.anonymous=o),"checked-children":"是","un-checked-children":"否"},null,8,["checked"]),t[23]||(t[23]=u("div",{class:"form-help-text"},"开启后，填写者无需登录即可参与",-1))]),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(xe,{title:"问题列表",class:"questions-card"},{extra:n(()=>[e(Qe,null,{default:n(()=>[e(f,{onClick:pe,disabled:g.value.length>0},{default:n(()=>[e(O(vt)),t[24]||(t[24]=x(" 导入问题 ",-1))]),_:1,__:[24]},8,["disabled"]),e(f,{type:"primary",onClick:t[6]||(t[6]=o=>y.value=!0)},{default:n(()=>[e(O(ae)),t[25]||(t[25]=x(" 添加问题 ",-1))]),_:1,__:[25]})]),_:1})]),default:n(()=>[u("div",Nt,[(m(!0),_(P,null,L(g.value,(o,ee)=>(m(),_("div",{key:o.id,class:"question-item"},[u("div",Vt,[u("span",jt,"Q"+S(ee+1),1),u("span",zt,S(j(o.type)),1),u("div",Bt,[e(f,{type:"link",onClick:C=>G(o)},{default:n(()=>[e(O(Ye)),t[26]||(t[26]=x(" 编辑 ",-1))]),_:2,__:[26]},1032,["onClick"]),e(f,{type:"link",onClick:C=>M(o)},{default:n(()=>[e(O(Ze)),t[27]||(t[27]=x(" 预览 ",-1))]),_:2,__:[27]},1032,["onClick"]),e(f,{type:"link",onClick:C=>de(o)},{default:n(()=>[e(O(Ke)),t[28]||(t[28]=x(" 复制 ",-1))]),_:2,__:[28]},1032,["onClick"]),e(Ae,{title:"确定要删除这个问题吗？",onConfirm:C=>q(o.id)},{default:n(()=>[e(f,{type:"link",danger:""},{default:n(()=>[e(O(le)),t[29]||(t[29]=x(" 删除 ",-1))]),_:1,__:[29]})]),_:2},1032,["onConfirm"])])]),u("div",Ft,[u("div",Ht,S(o.title),1),o.description?(m(),_("div",Jt,S(o.description),1)):D("",!0),o.options&&o.options.length?(m(),_("div",Gt,[(m(!0),_(P,null,L(o.options,C=>(m(),_("div",{key:C.id,class:"option-item"},[x(S(C.text)+" ",1),C.value?(m(),_("span",Wt,"("+S(C.value)+")",1)):D("",!0)]))),128))])):D("",!0),o.matrixRows&&o.matrixRows.length?(m(),_("div",Xt,[u("div",Yt,[(m(!0),_(P,null,L(o.matrixRows,C=>(m(),_("div",{key:C.id,class:"matrix-row"},S(C.text),1))),128))]),u("div",Zt,[(m(!0),_(P,null,L(o.matrixColumns,C=>(m(),_("div",{key:C.id,class:"matrix-column"},S(C.text),1))),128))])])):D("",!0)]),u("div",Kt,[e(Pe,{color:o.required?"red":"blue"},{default:n(()=>[x(S(o.required?"必填":"选填"),1)]),_:2},1032,["color"]),u("div",en,[e(f,{type:"text",onClick:C=>N(ee,"up"),disabled:ee===0},{default:n(()=>[e(O(dt))]),_:2},1032,["onClick","disabled"]),e(f,{type:"text",onClick:C=>N(ee,"down"),disabled:ee===g.value.length-1},{default:n(()=>[e(O(st))]),_:2},1032,["onClick","disabled"])])])]))),128)),g.value.length===0?(m(),_("div",tn,[e(Le,{description:"暂无问题，请添加问题开始设计问卷"},{image:n(()=>[u("div",nn,[e(O(Xe))])]),_:1})])):D("",!0)])]),_:1})]),e(At,{open:y.value,"onUpdate:open":t[7]||(t[7]=o=>y.value=o),question:E.value,onSave:ce},null,8,["open","question"]),e(he,{open:B.value,"onUpdate:open":t[12]||(t[12]=o=>B.value=o),title:"问题预览",width:"600px",footer:null},{default:n(()=>[u("div",an,[u("div",ln,[u("h4",null,S(a.value.title),1),a.value.description?(m(),_("p",on,S(a.value.description),1)):D("",!0),a.value.type==="single"?(m(),_("div",sn,[e(Me,{value:Y.value,"onUpdate:value":t[8]||(t[8]=o=>Y.value=o)},{default:n(()=>[(m(!0),_(P,null,L(a.value.options,o=>(m(),oe(Ee,{key:o.id,value:o.id},{default:n(()=>[x(S(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):D("",!0),a.value.type==="multiple"?(m(),_("div",rn,[e(Ve,{value:Z.value,"onUpdate:value":t[9]||(t[9]=o=>Z.value=o)},{default:n(()=>[(m(!0),_(P,null,L(a.value.options,o=>(m(),oe(Ne,{key:o.id,value:o.id},{default:n(()=>[x(S(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):D("",!0),a.value.type==="text"?(m(),_("div",un,[e(ye,{value:K.value,"onUpdate:value":t[10]||(t[10]=o=>K.value=o),placeholder:"请输入您的回答",rows:4},null,8,["value"])])):D("",!0),a.value.type==="rating"?(m(),_("div",dn,[e(je,{value:H.value,"onUpdate:value":t[11]||(t[11]=o=>H.value=o)},null,8,["value"]),u("div",cn,S(H.value)+"分",1)])):D("",!0),a.value.type==="matrix"?(m(),_("div",pn,[e(ze,{columns:w.value,"data-source":s.value,pagination:!1,size:"small"},null,8,["columns","data-source"])])):D("",!0)])])]),_:1},8,["open"]),e(he,{open:V.value,"onUpdate:open":t[14]||(t[14]=o=>V.value=o),title:"导入问题",width:"500px",onOk:T,onCancel:t[15]||(t[15]=o=>V.value=!1),"confirm-loading":X.value},{default:n(()=>[u("div",mn,[e(Be,{"file-list":F.value,"onUpdate:fileList":t[13]||(t[13]=o=>F.value=o),"before-upload":p,multiple:!1,accept:".json,.xlsx,.csv"},{default:n(()=>[e(f,null,{default:n(()=>[e(O(nt)),t[30]||(t[30]=x(" 选择文件 ",-1))]),_:1,__:[30]})]),_:1},8,["file-list"]),t[31]||(t[31]=u("div",{class:"import-help"},[u("p",null,"支持的文件格式：JSON、Excel、CSV"),u("p",null,"请确保文件格式符合系统要求")],-1))])]),_:1},8,["open","confirm-loading"])])}}},wn=Ue(vn,[["__scopeId","data-v-65c45dc4"]]);export{wn as default};
