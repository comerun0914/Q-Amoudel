import{f as t,A as le,u as Pe,r as p,l as Te,i as Le,n as $e,c as l,o as f,d as ae,w as n,e as o,p as h,m as c,g as u,t as g,h as y,k as H,R as Ne,E as qe,I as Ue,M as E}from"./index-90a1d7b0.js";import{_ as He}from"./_plugin-vue_export-helper-c27b6911.js";import{C as Ee}from"./CameraOutlined-6f810bc4.js";import{U as Be}from"./UserOutlined-9d80a557.js";import{L as Ze}from"./LogoutOutlined-9fb544b7.js";var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 384h56c4.4 0 8-3.6 8-8V200h176c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-37.6 0-68 30.4-68 68v180c0 4.4 3.6 8 8 8zm512-184h176v176c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V196c0-37.6-30.4-68-68-68H648c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM376 824H200V648c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v180c0 37.6 30.4 68 68 68h180c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm512-184h-56c-4.4 0-8 3.6-8 8v176H648c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h180c37.6 0 68-30.4 68-68V648c0-4.4-3.6-8-8-8zm16-164H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"scan",theme:"outlined"};const Re=Ge;function se(d){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?Object(arguments[i]):{},v=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(r).filter(function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable}))),v.forEach(function(m){Ve(d,m,r[m])})}return d}function Ve(d,i,r){return i in d?Object.defineProperty(d,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[i]=r,d}var B=function(i,r){var v=se({},i,r.attrs);return t(le,se({},v,{icon:Re}),null)};B.displayName="ScanOutlined";B.inheritAttrs=!1;const Qe=B;var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};const Je=Ye;function ie(d){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?Object(arguments[i]):{},v=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(r).filter(function(m){return Object.getOwnPropertyDescriptor(r,m).enumerable}))),v.forEach(function(m){We(d,m,r[m])})}return d}function We(d,i,r){return i in d?Object.defineProperty(d,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[i]=r,d}var Z=function(i,r){var v=ie({},i,r.attrs);return t(le,ie({},v,{icon:Je}),null)};Z.displayName="StopOutlined";Z.inheritAttrs=!1;const Ke=Z;const Fe={class:"ask-user-container"},Xe={class:"nav-links"},et={class:"user-name"},tt={class:"main-content"},nt={class:"ask-container"},ot={class:"input-methods"},at={class:"method-content"},st={class:"input-section"},it={class:"method-content"},lt={class:"input-section"},rt={class:"method-content"},ut={class:"qr-section"},ct={class:"qr-container"},dt={id:"qr-reader",ref:"qrReader"},pt={class:"qr-controls"},vt={class:"recent-section"},mt={class:"recent-list"},_t=["onClick"],ft={class:"questionnaire-meta"},gt={class:"history-section"},yt={class:"history-filters"},kt=["onClick"],bt={class:"questionnaire-meta"},Mt={__name:"AskUser",setup(d){const i=Pe(),r=p("link"),v=p(""),m=p(""),A=p(!1),x=p(!1),j=p(!1),k=p(!1),w=p(!1),z=p(!1),D=p(""),I=p(""),P=p(!0),T=p([]),G=p([]),L=p(!1),$=p(!1),re=p("用户名"),ue=p("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM2NjZFRkEiLz4KPHBhdGggZD0iTTE2IDhDMTguMjA5MSA4IDIwIDkuNzkwODYgMjAgMTJDMjAgMTQuMjA5MSAxOC4yMDkxIDE2IDE2IDE2QzEzLjc5MDkgMTYgMTIgMTQuMjA5MSAxMiAxMkMxMiA5Ljc5MDg2IDEzLjc5MDkgOCAxNiA4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTI0IDI0QzI0IDIwLjY4NjMgMjAuNDE0MiAxOCAxNiAxOEMxMS41ODU4IDE4IDggMjAuNjg2MyA4IDI0IiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"),ce=Te(()=>{let a=G.value;return D.value&&(a=a.filter(e=>e.title.toLowerCase().includes(D.value.toLowerCase()))),I.value&&(a=a.filter(e=>e.status===I.value)),a}),de=async()=>{if(!v.value){c.warning("请输入问卷链接");return}A.value=!0;try{c.success("链接验证成功，正在跳转..."),i.push(`/questionnaire/fill?url=${encodeURIComponent(v.value)}`)}catch{c.error("链接验证失败，请检查链接是否正确")}finally{A.value=!1}},pe=async()=>{if(!m.value){c.warning("请输入问卷代码");return}if(m.value.length!==6){c.warning("问卷代码应为6位字符");return}x.value=!0;try{c.success("代码验证成功，正在跳转..."),i.push(`/questionnaire/fill?code=${m.value}`)}catch{c.error("代码验证失败，请检查代码是否正确")}finally{x.value=!1}},R=()=>{if(typeof Html5Qrcode>"u"){c.error("二维码扫描功能不可用，请检查网络连接");return}j.value=!0,k.value=!0,setTimeout(()=>{j.value=!1,c.success("扫描功能已启动")},1e3)},V=()=>{k.value=!1,c.info("扫描已停止")},ve=()=>{c.info("正在切换摄像头...")},me=()=>{navigator.permissions&&navigator.permissions.query?navigator.permissions.query({name:"camera"}).then(a=>{let e="未知";switch(a.state){case"granted":e="已授权";break;case"denied":e="已拒绝";break;case"prompt":e="需要授权";break}c.info(`摄像头权限状态: ${e}`)}):c.info("无法检测权限状态，请手动检查")},_e=()=>{const a={userAgent:navigator.userAgent,camera:"camera"in navigator||"getUserMedia"in navigator,permissions:"permissions"in navigator,mediaDevices:"mediaDevices"in navigator};E.info({title:"浏览器兼容性信息",content:`
      <div>
        <p><strong>用户代理:</strong> ${a.userAgent}</p>
        <p><strong>摄像头支持:</strong> ${a.camera?"是":"否"}</p>
        <p><strong>权限API:</strong> ${a.permissions?"是":"否"}</p>
        <p><strong>媒体设备API:</strong> ${a.mediaDevices?"是":"否"}</p>
      </div>
    `,dangerouslySetHTMLContent:!0})},fe=()=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(a=>{const e=a.filter(b=>b.kind==="videoinput");if(e.length>0){const b=e.map((N,C)=>`${C+1}. ${N.label||`摄像头 ${C+1}`}`).join(`
`);E.info({title:"摄像头信息",content:`检测到 ${e.length} 个摄像头:
${b}`,okText:"确定"})}else c.warning("未检测到摄像头设备")}).catch(()=>{c.error("无法获取摄像头信息")}):c.warning("浏览器不支持摄像头检测")},ge=()=>{P.value=!1},Q=()=>{z.value=!0,ye()},ye=async()=>{$.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),G.value=[{id:1,title:"用户满意度调查",fillTime:new Date("2025-01-15"),status:"completed"},{id:2,title:"产品使用体验问卷",fillTime:new Date("2025-01-10"),status:"in-progress"}]}catch{c.error("加载历史数据失败")}finally{$.value=!1}},ke=async()=>{L.value=!0;try{await new Promise(a=>setTimeout(a,800)),T.value=[{id:1,title:"用户满意度调查",fillTime:new Date("2025-01-15"),status:"completed"}]}catch{c.error("加载最近数据失败")}finally{L.value=!1}},O=a=>{i.push(`/questionnaire/fill/${a}`)},be=()=>{i.push("/user")},Me=()=>{E.confirm({title:"确认退出",content:"确定要退出登录吗？",onOk:()=>{localStorage.clear(),i.push("/login"),c.success("已退出登录")}})},he=()=>{w.value=!w.value},Y=a=>new Date(a).toLocaleDateString("zh-CN"),J=a=>({completed:"success","in-progress":"processing",expired:"error"})[a]||"default",W=a=>({completed:"已完成","in-progress":"进行中",expired:"已过期"})[a]||"未知";return Le(()=>{ke(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||(P.value=!1)}),$e(()=>{k.value&&V()}),(a,e)=>{const b=l("router-link"),N=l("a-avatar"),C=l("a-menu-item"),Ce=l("a-menu"),we=l("a-dropdown"),De=l("a-layout-header"),q=l("a-input"),_=l("a-button"),K=l("a-input-group"),F=l("a-form-item"),U=l("a-tab-pane"),Ie=l("a-alert"),Oe=l("a-space"),Se=l("a-tabs"),Ae=l("a-empty"),X=l("a-tag"),ee=l("a-list-item-meta"),te=l("a-list-item"),ne=l("a-list"),oe=l("a-col"),S=l("a-select-option"),xe=l("a-select"),je=l("a-row"),ze=l("a-modal");return f(),ae("div",Fe,[t(De,{class:"navbar"},{default:n(()=>[e[11]||(e[11]=o("div",{class:"logo"},"幼儿星",-1)),o("div",Xe,[t(b,{to:"/user",class:"nav-link"},{default:n(()=>e[7]||(e[7]=[u("用户中心",-1)])),_:1,__:[7]}),t(b,{to:"/ask-user",class:"nav-link active"},{default:n(()=>e[8]||(e[8]=[u("问卷填写",-1)])),_:1,__:[8]}),o("a",{class:"nav-link",onClick:Q},"我的记录"),o("div",{class:"user-info",onClick:he},[t(N,{src:ue.value,class:"user-avatar"},null,8,["src"]),o("span",et,g(re.value),1),t(we,{open:w.value,"onUpdate:open":e[0]||(e[0]=s=>w.value=s),placement:"bottomRight"},{overlay:n(()=>[t(Ce,null,{default:n(()=>[t(C,{key:"userCenter",onClick:be},{default:n(()=>[t(y(Be)),e[9]||(e[9]=u(" 用户中心 ",-1))]),_:1,__:[9]}),t(C,{key:"logout",onClick:Me},{default:n(()=>[t(y(Ze)),e[10]||(e[10]=u(" 退出登录 ",-1))]),_:1,__:[10]})]),_:1})]),_:1},8,["open"])])])]),_:1,__:[11]}),o("main",tt,[o("div",nt,[e[27]||(e[27]=o("h1",null,"我的问卷记录",-1)),e[28]||(e[28]=o("p",{class:"page-description"},"查看您已填写过的问卷记录",-1)),o("div",ot,[t(Se,{activeKey:r.value,"onUpdate:activeKey":e[3]||(e[3]=s=>r.value=s),class:"method-tabs"},{default:n(()=>[t(U,{key:"link",tab:"链接输入"},{default:n(()=>[o("div",at,[o("div",st,[t(F,{label:"问卷链接"},{default:n(()=>[t(K,{compact:""},{default:n(()=>[t(q,{value:v.value,"onUpdate:value":e[1]||(e[1]=s=>v.value=s),placeholder:"请输入问卷链接，例如：https://example.com/questionnaire/123",style:{width:"calc(100% - 120px)"}},null,8,["value"]),t(_,{type:"primary",onClick:de,loading:A.value},{default:n(()=>e[12]||(e[12]=[u(" 开始填写 ",-1)])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1}),e[13]||(e[13]=o("p",{class:"input-hint"},"请从问卷发布者处获取完整的问卷链接",-1))])])]),_:1}),t(U,{key:"code",tab:"问卷代码"},{default:n(()=>[o("div",it,[o("div",lt,[t(F,{label:"问卷代码"},{default:n(()=>[t(K,{compact:""},{default:n(()=>[t(q,{value:m.value,"onUpdate:value":e[2]||(e[2]=s=>m.value=s),placeholder:"请输入6位问卷代码，例如：ABC123",style:{width:"calc(100% - 120px)"},maxlength:"6"},null,8,["value"]),t(_,{type:"primary",onClick:pe,loading:x.value},{default:n(()=>e[14]||(e[14]=[u(" 开始填写 ",-1)])),_:1,__:[14]},8,["loading"])]),_:1})]),_:1}),e[15]||(e[15]=o("p",{class:"input-hint"},"问卷代码通常为6位字母数字组合",-1))])])]),_:1}),t(U,{key:"qr",tab:"二维码扫描"},{default:n(()=>[o("div",rt,[o("div",ut,[P.value?(f(),h(Ie,{key:0,message:"📱 移动端使用提示",description:"在移动设备上使用二维码扫描功能时，需要授予摄像头权限。首次使用时会弹出权限请求，选择'允许'即可正常使用。如被拒绝，可在设置中手动开启。",type:"info","show-icon":"",closable:"",onClose:ge,class:"mobile-permission-hint"})):H("",!0),o("div",ct,[o("div",dt,null,512),k.value?H("",!0):(f(),ae("div",{key:0,class:"qr-overlay",onClick:R},e[16]||(e[16]=[o("div",{class:"qr-placeholder"},[o("div",{class:"qr-icon"},"📱"),o("p",null,"点击开始扫描二维码")],-1)])))]),o("div",pt,[t(Oe,null,{default:n(()=>[k.value?(f(),h(_,{key:1,onClick:V},{default:n(()=>[t(y(Ke)),e[18]||(e[18]=u(" 停止扫描 ",-1))]),_:1,__:[18]})):(f(),h(_,{key:0,type:"primary",onClick:R,loading:j.value},{default:n(()=>[t(y(Qe)),e[17]||(e[17]=u(" 开始扫描 ",-1))]),_:1,__:[17]},8,["loading"])),k.value?(f(),h(_,{key:2,onClick:ve},{default:n(()=>[t(y(Ne)),e[19]||(e[19]=u(" 切换摄像头 ",-1))]),_:1,__:[19]})):H("",!0),t(_,{onClick:me},{default:n(()=>[t(y(qe)),e[20]||(e[20]=u(" 检测权限 ",-1))]),_:1,__:[20]}),t(_,{onClick:_e},{default:n(()=>[t(y(Ue)),e[21]||(e[21]=u(" 浏览器兼容性 ",-1))]),_:1,__:[21]}),t(_,{onClick:fe},{default:n(()=>[t(y(Ee)),e[22]||(e[22]=u(" 摄像头信息 ",-1))]),_:1,__:[22]})]),_:1}),e[23]||(e[23]=o("p",{class:"input-hint"},"将二维码对准摄像头进行扫描",-1))])])])]),_:1})]),_:1},8,["activeKey"])]),o("div",vt,[e[26]||(e[26]=o("h2",null,"最近填写的问卷",-1)),o("div",mt,[T.value.length===0?(f(),h(Ae,{key:0,description:"暂无填写记录"})):(f(),h(ne,{key:1,"data-source":T.value,loading:L.value,"item-layout":"horizontal"},{renderItem:n(({item:s})=>[t(te,null,{actions:n(()=>[t(_,{type:"link",onClick:M=>O(s.id)},{default:n(()=>e[24]||(e[24]=[u(" 继续填写 ",-1)])),_:2,__:[24]},1032,["onClick"])]),default:n(()=>[t(ee,null,{title:n(()=>[o("a",{onClick:M=>O(s.id)},g(s.title),9,_t)]),description:n(()=>[o("div",ft,[o("span",null,"填写时间: "+g(Y(s.fillTime)),1),t(X,{color:J(s.status)},{default:n(()=>[u(g(W(s.status)),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source","loading"]))]),o("div",gt,[t(_,{onClick:Q,type:"default"},{default:n(()=>e[25]||(e[25]=[u(" 查看所有历史记录 ",-1)])),_:1,__:[25]})])])])]),t(ze,{open:z.value,"onUpdate:open":e[6]||(e[6]=s=>z.value=s),title:"我的填写历史",width:"800px",footer:null},{default:n(()=>[o("div",yt,[t(je,{gutter:16},{default:n(()=>[t(oe,{span:12},{default:n(()=>[t(q,{value:D.value,"onUpdate:value":e[4]||(e[4]=s=>D.value=s),placeholder:"搜索问卷标题...","allow-clear":""},null,8,["value"])]),_:1}),t(oe,{span:12},{default:n(()=>[t(xe,{value:I.value,"onUpdate:value":e[5]||(e[5]=s=>I.value=s),placeholder:"选择状态",style:{width:"100%"},"allow-clear":""},{default:n(()=>[t(S,{value:""},{default:n(()=>e[29]||(e[29]=[u("所有状态",-1)])),_:1,__:[29]}),t(S,{value:"completed"},{default:n(()=>e[30]||(e[30]=[u("已完成",-1)])),_:1,__:[30]}),t(S,{value:"in-progress"},{default:n(()=>e[31]||(e[31]=[u("进行中",-1)])),_:1,__:[31]}),t(S,{value:"expired"},{default:n(()=>e[32]||(e[32]=[u("已过期",-1)])),_:1,__:[32]})]),_:1},8,["value"])]),_:1})]),_:1})]),t(ne,{"data-source":ce.value,loading:$.value,"item-layout":"horizontal",class:"history-list",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,M)=>`第 ${M[0]}-${M[1]} 条，共 ${s} 条`}},{renderItem:n(({item:s})=>[t(te,null,{actions:n(()=>[t(_,{type:"link",onClick:M=>O(s.id)},{default:n(()=>[u(g(s.status==="completed"?"查看结果":"继续填写"),1)]),_:2},1032,["onClick"])]),default:n(()=>[t(ee,null,{title:n(()=>[o("a",{onClick:M=>O(s.id)},g(s.title),9,kt)]),description:n(()=>[o("div",bt,[o("span",null,"填写时间: "+g(Y(s.fillTime)),1),t(X,{color:J(s.status)},{default:n(()=>[u(g(W(s.status)),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source","loading","pagination"])]),_:1},8,["open"]),e[33]||(e[33]=o("footer",{class:"footer"},[o("div",{class:"copyright"},"© 2025 湖北工程学院. 保留所有权利")],-1))])}}},Ot=He(Mt,[["__scopeId","data-v-7d07215e"]]);export{Ot as default};
