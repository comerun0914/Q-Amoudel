import{f as n,A as Y,a as Oe,r as b,b as U,i as ke,c as d,o as C,d as N,e as t,w as o,m as l,q as $,C as E,h as w,g as F,v as J,t as y,E as Se,F as Ue,H as Ce,k as Re,p as Ae,W as Ie}from"./index-90a1d7b0.js";import{_ as Ne}from"./_plugin-vue_export-helper-c27b6911.js";import{S as $e}from"./SaveOutlined-03c9a56b.js";import{U as Q}from"./UserOutlined-9d80a557.js";import{C as Ee}from"./CameraOutlined-6f810bc4.js";import{T as H}from"./TeamOutlined-2172b8fb.js";import{L as Fe}from"./LockOutlined-6b4a3ed2.js";import{S as Le}from"./SettingOutlined-9aa5e4f1.js";var Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M816 768h-24V428c0-141.1-104.3-257.7-240-277.1V112c0-22.1-17.9-40-40-40s-40 17.9-40 40v38.9c-135.7 19.4-240 136-240 277.1v340h-24c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h216c0 61.8 50.2 112 112 112s112-50.2 112-112h216c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM512 888c-26.5 0-48-21.5-48-48h96c0 26.5-21.5 48-48 48zM304 768V428c0-55.6 21.6-107.8 60.9-147.1S456.4 220 512 220c55.6 0 107.8 21.6 147.1 60.9S720 372.4 720 428v340H304z"}}]},name:"bell",theme:"outlined"};const xe=Me;function W(c){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?Object(arguments[i]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable}))),u.forEach(function(p){ze(c,p,r[p])})}return c}function ze(c,i,r){return i in c?Object.defineProperty(c,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[i]=r,c}var z=function(i,r){var u=W({},i,r.attrs);return n(Y,W({},u,{icon:xe}),null)};z.displayName="BellOutlined";z.inheritAttrs=!1;const Be=z;var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};const Te=De;function X(c){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?Object(arguments[i]):{},u=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(r).filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable}))),u.forEach(function(p){je(c,p,r[p])})}return c}function je(c,i,r){return i in c?Object.defineProperty(c,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[i]=r,c}var B=function(i,r){var u=X({},i,r.attrs);return n(Y,X({},u,{icon:Te}),null)};B.displayName="StarOutlined";B.inheritAttrs=!1;const qe=B;const Ve={class:"user-center-page"},Ge={class:"page-header"},Je={class:"header-actions"},Qe={class:"user-content"},He={class:"user-avatar-section"},We={class:"avatar-actions"},Xe={class:"stat-item"},Ye={class:"stat-icon"},Ze={class:"stat-content"},Ke={class:"stat-number"},et={class:"stat-item"},tt={class:"stat-icon"},st={class:"stat-content"},nt={class:"stat-number"},at={class:"stat-item"},ot={class:"stat-icon"},it={class:"stat-content"},rt={class:"stat-number"},lt={class:"stat-item"},ct={class:"stat-icon"},dt={class:"stat-content"},ut={class:"stat-number"},pt={class:"security-settings"},mt={class:"setting-item"},vt={class:"setting-item"},ft={class:"setting-item"},gt={class:"privacy-settings"},_t={class:"setting-item"},ht={class:"setting-item"},bt={class:"setting-item"},wt={class:"notification-settings"},yt={class:"setting-item"},Pt={class:"setting-item"},Ot={class:"setting-item"},kt={class:"activity-list"},St={class:"activity-icon"},Ut={class:"activity-content"},Ct={class:"activity-title"},Rt={class:"activity-time"},At={class:"activity-action"},It={key:0,class:"empty-activities"},Nt={__name:"UserCenter",setup(c){const i=Oe(),r=b(!1),u=b(!1),p=b(!1),D=b("security"),Z=b(),T=b(),j=b([]),m=U({username:"",nickname:"",email:"",phone:"",bio:"",avatar:""}),P=U({totalQuestionnaires:0,totalResponses:0,totalViews:0,avgRating:0}),R=U({twoFactorAuth:!1,loginNotification:!0}),O=U({dataCollection:!0,personalization:!0,publicProfile:!1}),k=U({email:!0,questionnaireResponse:!0,systemUpdate:!1}),f=U({currentPassword:"",newPassword:"",confirmPassword:""}),q=b([]),K={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度在2-20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},ee={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,e)=>e!==f.newPassword?Promise.reject("两次输入的密码不一致"):Promise.resolve(),trigger:"blur"}]},te=async()=>{try{const s=i.user;s&&Object.assign(m,{username:s.username||"",nickname:s.nickname||"",email:s.email||"",phone:s.phone||"",bio:s.bio||"",avatar:s.avatar||""}),await se(),await ne(),await ae()}catch(s){console.error("加载用户信息失败:",s),l.error("加载用户信息失败")}},se=async()=>{try{const s=await $.get(E.API_ENDPOINTS.USER_PROFILE);s.code===200?P.value=s.data.stats||P.value:l.error(s.message||"获取统计数据失败")}catch(s){console.error("获取用户统计失败:",s)}},ne=async()=>{try{const s=await $.get(E.API_ENDPOINTS.USER_PROFILE);s.code===200?userSettings.value=s.data.settings||userSettings.value:l.error(s.message||"获取设置失败")}catch(s){console.error("获取用户设置失败:",s)}},ae=async()=>{try{const s=await $.get(E.API_ENDPOINTS.USER_PROFILE);s.code===200?userActivities.value=s.data.activities||userActivities.value:l.error(s.message||"获取活动记录失败")}catch(s){console.error("获取用户活动失败:",s)}},oe=s=>{if(!(s.type==="image/jpeg"||s.type==="image/png"))return l.error("只能上传 JPG/PNG 格式的图片!"),!1;if(!(s.size/1024/1024<2))return l.error("图片大小不能超过 2MB!"),!1;const v=new FileReader;return v.onload=L=>{m.avatar=L.target.result},v.readAsDataURL(s),!1},ie=async()=>{var s;try{await((s=T.value)==null?void 0:s.validate()),u.value=!0;const e=await $.put(E.API_ENDPOINTS.USER_PROFILE,{currentPassword:f.currentPassword,newPassword:f.newPassword});e.code===200?(l.success("密码修改成功"),p.value=!1,Object.assign(f,{currentPassword:"",newPassword:"",confirmPassword:""})):l.error(e.message||"密码修改失败")}catch(e){console.error("修改密码失败:",e),e.name==="ValidationError"?l.error("请检查表单信息"):l.error("修改失败，请稍后重试")}finally{u.value=!1}},re=s=>{l.success(`两步验证已${s?"启用":"禁用"}`)},le=s=>{l.success(`登录通知已${s?"启用":"禁用"}`)},ce=s=>{l.success(`数据收集已${s?"启用":"禁用"}`)},de=s=>{l.success(`个性化推荐已${s?"启用":"禁用"}`)},ue=s=>{l.success(`公开资料已${s?"启用":"禁用"}`)},pe=s=>{l.success(`邮件通知已${s?"启用":"禁用"}`)},me=s=>{l.success(`问卷回复通知已${s?"启用":"禁用"}`)},ve=s=>{l.success(`系统更新通知已${s?"启用":"禁用"}`)},fe=s=>({questionnaire_created:J,response_received:H,profile_updated:Q,login:Fe,setting_changed:Le})[s]||Be,ge=s=>({questionnaire_created:"查看问卷",response_received:"查看回复",profile_updated:"查看资料",login:"查看详情",setting_changed:"查看设置"})[s]||"查看详情",_e=s=>{switch(s.type){case"questionnaire_created":break;case"response_received":break;case"profile_updated":break;default:l.info("功能开发中...")}},he=s=>{const e=new Date,g=new Date(s),v=e-g;return v<6e4?"刚刚":v<36e5?`${Math.floor(v/6e4)}分钟前`:v<864e5?`${Math.floor(v/36e5)}小时前`:v<2592e6?`${Math.floor(v/864e5)}天前`:g.toLocaleDateString("zh-CN")};return ke(()=>{te()}),(s,e)=>{const g=d("a-button"),v=d("a-avatar"),L=d("a-upload"),A=d("a-input"),_=d("a-form-item"),be=d("a-textarea"),V=d("a-form"),I=d("a-card"),S=d("a-col"),G=d("a-row"),h=d("a-switch"),M=d("a-tab-pane"),we=d("a-tabs"),ye=d("a-empty"),x=d("a-input-password"),Pe=d("a-modal");return C(),N("div",Ve,[t("div",Ge,[e[22]||(e[22]=t("div",{class:"header-left"},[t("h1",null,"用户中心"),t("p",null,"管理您的个人信息和账户设置")],-1)),t("div",Je,[n(g,{type:"primary",onClick:s.saveUserInfo,loading:r.value},{default:o(()=>[n(w($e)),e[21]||(e[21]=F(" 保存设置 ",-1))]),_:1,__:[21]},8,["onClick","loading"])])]),t("div",Qe,[n(G,{gutter:24},{default:o(()=>[n(S,{span:8},{default:o(()=>[n(I,{title:"个人信息",class:"user-info-card"},{default:o(()=>[t("div",He,[n(v,{size:120,src:m.avatar},{icon:o(()=>[n(w(Q))]),_:1},8,["src"]),t("div",We,[n(L,{"file-list":j.value,"onUpdate:fileList":e[0]||(e[0]=a=>j.value=a),"before-upload":oe,"show-upload-list":!1,accept:"image/*"},{default:o(()=>[n(g,{size:"small"},{default:o(()=>[n(w(Ee)),e[23]||(e[23]=F(" 更换头像 ",-1))]),_:1,__:[23]})]),_:1},8,["file-list"])])]),n(V,{model:m,rules:K,layout:"vertical",ref_key:"userInfoFormRef",ref:Z},{default:o(()=>[n(_,{label:"用户名",name:"username"},{default:o(()=>[n(A,{value:m.username,"onUpdate:value":e[1]||(e[1]=a=>m.username=a),placeholder:"请输入用户名",disabled:!0},null,8,["value"])]),_:1}),n(_,{label:"昵称",name:"nickname"},{default:o(()=>[n(A,{value:m.nickname,"onUpdate:value":e[2]||(e[2]=a=>m.nickname=a),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),n(_,{label:"邮箱",name:"email"},{default:o(()=>[n(A,{value:m.email,"onUpdate:value":e[3]||(e[3]=a=>m.email=a),placeholder:"请输入邮箱",type:"email"},null,8,["value"])]),_:1}),n(_,{label:"手机号",name:"phone"},{default:o(()=>[n(A,{value:m.phone,"onUpdate:value":e[4]||(e[4]=a=>m.phone=a),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),n(_,{label:"个人简介",name:"bio"},{default:o(()=>[n(be,{value:m.bio,"onUpdate:value":e[5]||(e[5]=a=>m.bio=a),placeholder:"请输入个人简介",rows:3,maxlength:200,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),n(S,{span:16},{default:o(()=>[n(I,{title:"账户统计",class:"stats-card"},{default:o(()=>[n(G,{gutter:16},{default:o(()=>[n(S,{span:6},{default:o(()=>[t("div",Xe,[t("div",Ye,[n(w(J))]),t("div",Ze,[t("div",Ke,y(P.totalQuestionnaires),1),e[24]||(e[24]=t("div",{class:"stat-label"},"创建问卷",-1))])])]),_:1}),n(S,{span:6},{default:o(()=>[t("div",et,[t("div",tt,[n(w(H))]),t("div",st,[t("div",nt,y(P.totalResponses),1),e[25]||(e[25]=t("div",{class:"stat-label"},"总回复数",-1))])])]),_:1}),n(S,{span:6},{default:o(()=>[t("div",at,[t("div",ot,[n(w(Se))]),t("div",it,[t("div",rt,y(P.totalViews),1),e[26]||(e[26]=t("div",{class:"stat-label"},"总浏览量",-1))])])]),_:1}),n(S,{span:6},{default:o(()=>[t("div",lt,[t("div",ct,[n(w(qe))]),t("div",dt,[t("div",ut,y(P.avgRating),1),e[27]||(e[27]=t("div",{class:"stat-label"},"平均评分",-1))])])]),_:1})]),_:1})]),_:1}),n(I,{title:"账户设置",class:"settings-card"},{default:o(()=>[n(we,{activeKey:D.value,"onUpdate:activeKey":e[15]||(e[15]=a=>D.value=a)},{default:o(()=>[n(M,{key:"security",tab:"安全设置"},{default:o(()=>[t("div",pt,[t("div",mt,[e[29]||(e[29]=t("div",{class:"setting-info"},[t("h4",null,"修改密码"),t("p",null,"定期更换密码可以提高账户安全性")],-1)),n(g,{onClick:e[6]||(e[6]=a=>p.value=!0)},{default:o(()=>e[28]||(e[28]=[F(" 修改密码 ",-1)])),_:1,__:[28]})]),t("div",vt,[e[30]||(e[30]=t("div",{class:"setting-info"},[t("h4",null,"两步验证"),t("p",null,"启用两步验证，为账户提供额外保护")],-1)),n(h,{checked:R.twoFactorAuth,"onUpdate:checked":e[7]||(e[7]=a=>R.twoFactorAuth=a),onChange:re},null,8,["checked"])]),t("div",ft,[e[31]||(e[31]=t("div",{class:"setting-info"},[t("h4",null,"登录通知"),t("p",null,"在新设备登录时发送邮件通知")],-1)),n(h,{checked:R.loginNotification,"onUpdate:checked":e[8]||(e[8]=a=>R.loginNotification=a),onChange:le},null,8,["checked"])])])]),_:1}),n(M,{key:"privacy",tab:"隐私设置"},{default:o(()=>[t("div",gt,[t("div",_t,[e[32]||(e[32]=t("div",{class:"setting-info"},[t("h4",null,"数据收集"),t("p",null,"允许系统收集使用数据以改善服务")],-1)),n(h,{checked:O.dataCollection,"onUpdate:checked":e[9]||(e[9]=a=>O.dataCollection=a),onChange:ce},null,8,["checked"])]),t("div",ht,[e[33]||(e[33]=t("div",{class:"setting-info"},[t("h4",null,"个性化推荐"),t("p",null,"基于使用习惯提供个性化功能推荐")],-1)),n(h,{checked:O.personalization,"onUpdate:checked":e[10]||(e[10]=a=>O.personalization=a),onChange:de},null,8,["checked"])]),t("div",bt,[e[34]||(e[34]=t("div",{class:"setting-info"},[t("h4",null,"公开资料"),t("p",null,"允许其他用户查看您的基本资料")],-1)),n(h,{checked:O.publicProfile,"onUpdate:checked":e[11]||(e[11]=a=>O.publicProfile=a),onChange:ue},null,8,["checked"])])])]),_:1}),n(M,{key:"notifications",tab:"通知设置"},{default:o(()=>[t("div",wt,[t("div",yt,[e[35]||(e[35]=t("div",{class:"setting-info"},[t("h4",null,"邮件通知"),t("p",null,"接收重要的系统通知和更新信息")],-1)),n(h,{checked:k.email,"onUpdate:checked":e[12]||(e[12]=a=>k.email=a),onChange:pe},null,8,["checked"])]),t("div",Pt,[e[36]||(e[36]=t("div",{class:"setting-info"},[t("h4",null,"问卷回复通知"),t("p",null,"当有人回复您的问卷时发送通知")],-1)),n(h,{checked:k.questionnaireResponse,"onUpdate:checked":e[13]||(e[13]=a=>k.questionnaireResponse=a),onChange:me},null,8,["checked"])]),t("div",Ot,[e[37]||(e[37]=t("div",{class:"setting-info"},[t("h4",null,"系统更新通知"),t("p",null,"接收系统功能更新和维护通知")],-1)),n(h,{checked:k.systemUpdate,"onUpdate:checked":e[14]||(e[14]=a=>k.systemUpdate=a),onChange:ve},null,8,["checked"])])])]),_:1})]),_:1},8,["activeKey"])]),_:1}),n(I,{title:"最近活动",class:"activity-card"},{default:o(()=>[t("div",kt,[(C(!0),N(Ue,null,Ce(q.value,a=>(C(),N("div",{key:a.id,class:"activity-item"},[t("div",St,[(C(),Ae(Ie(fe(a.type))))]),t("div",Ut,[t("div",Ct,y(a.title),1),t("div",Rt,y(he(a.time)),1)]),t("div",At,[n(g,{type:"link",size:"small",onClick:$t=>_e(a)},{default:o(()=>[F(y(ge(a.type)),1)]),_:2},1032,["onClick"])])]))),128)),q.value.length===0?(C(),N("div",It,[n(ye,{description:"暂无活动记录"})])):Re("",!0)])]),_:1})]),_:1})]),_:1})]),n(Pe,{open:p.value,title:"修改密码",width:"500px",onOk:ie,onCancel:e[19]||(e[19]=a=>p.value=!1),"onUpdate:open":e[20]||(e[20]=a=>p.value=a),"confirm-loading":u.value},{default:o(()=>[n(V,{model:f,rules:ee,layout:"vertical",ref_key:"passwordFormRef",ref:T},{default:o(()=>[n(_,{label:"当前密码",name:"currentPassword"},{default:o(()=>[n(x,{value:f.currentPassword,"onUpdate:value":e[16]||(e[16]=a=>f.currentPassword=a),placeholder:"请输入当前密码"},null,8,["value"])]),_:1}),n(_,{label:"新密码",name:"newPassword"},{default:o(()=>[n(x,{value:f.newPassword,"onUpdate:value":e[17]||(e[17]=a=>f.newPassword=a),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),n(_,{label:"确认新密码",name:"confirmPassword"},{default:o(()=>[n(x,{value:f.confirmPassword,"onUpdate:value":e[18]||(e[18]=a=>f.confirmPassword=a),placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},Tt=Ne(Nt,[["__scopeId","data-v-a7f75c50"]]);export{Tt as default};
