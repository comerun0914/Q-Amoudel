<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®å·å¡«å†™è°ƒè¯•é¡µé¢ - å¢å¼ºç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .debug-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .debug-content {
            background: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
            background: #ffe6e6;
            border: 1px solid #ff9999;
        }
        .success {
            color: green;
            background: #e6ffe6;
            border: 1px solid #99ff99;
        }
        .warning {
            color: orange;
            background: #fff3e6;
            border: 1px solid #ffcc80;
        }
        .button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #40a9ff;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .data-analysis {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .data-item {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>é—®å·å¡«å†™è°ƒè¯•é¡µé¢ - å¢å¼ºç‰ˆ</h1>
        <p>ç”¨äºè°ƒè¯•é—®å·å¡«å†™é¡µé¢çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é¢˜ç›®ä¿¡æ¯æ˜¾ç¤ºé—®é¢˜</p>
        
        <div class="debug-section">
            <div class="debug-title">æµ‹è¯•é—®å·ID: 77106636</div>
            <button class="button" onclick="testQuestionnaireDetail()">æµ‹è¯•è·å–é—®å·è¯¦æƒ…</button>
            <button class="button" onclick="testQuestionnaireQuestions()">æµ‹è¯•è·å–é—®é¢˜åˆ—è¡¨</button>
            <button class="button" onclick="testFullFlow()">æµ‹è¯•å®Œæ•´æµç¨‹</button>
            <button class="button" onclick="analyzeDataStructure()">åˆ†ææ•°æ®ç»“æ„</button>
            <button class="button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">è°ƒè¯•æ—¥å¿—</div>
            <div id="debugLogs" class="debug-content"></div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">APIå“åº”æ•°æ®</div>
            <div id="apiResponse" class="debug-content"></div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">æ•°æ®ç»“æ„åˆ†æ</div>
            <div id="dataAnalysis" class="debug-content"></div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">é”™è¯¯ä¿¡æ¯</div>
            <div id="errorInfo" class="debug-content"></div>
        </div>
    </div>

    <script>
        const DEBUG_LOGS = [];
        const API_BASE = 'http://localhost:7070/api';
        let lastDetailData = null;
        let lastQuestionsData = null;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            DEBUG_LOGS.push(logEntry);
            
            const logsDiv = document.getElementById('debugLogs');
            logsDiv.textContent = DEBUG_LOGS.join('\n');
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(logEntry);
        }
        
        function showResponse(title, data) {
            const responseDiv = document.getElementById('apiResponse');
            responseDiv.innerHTML = `<strong>${title}:</strong>\n${JSON.stringify(data, null, 2)}`;
        }
        
        function showError(error) {
            const errorDiv = document.getElementById('errorInfo');
            errorDiv.innerHTML = `<strong>é”™è¯¯:</strong>\n${error.message || error}\n\n<strong>å †æ ˆ:</strong>\n${error.stack || 'æ— å †æ ˆä¿¡æ¯'}`;
            errorDiv.className = 'debug-content error';
        }
        
        function clearLogs() {
            DEBUG_LOGS.length = 0;
            document.getElementById('debugLogs').textContent = '';
            document.getElementById('apiResponse').textContent = '';
            document.getElementById('errorInfo').textContent = '';
            document.getElementById('errorInfo').className = 'debug-content';
            document.getElementById('dataAnalysis').textContent = '';
        }
        
        async function testQuestionnaireDetail() {
            try {
                log('å¼€å§‹æµ‹è¯•è·å–é—®å·è¯¦æƒ…...');
                const response = await fetch(`${API_BASE}/questionCreate/detail/77106636`);
                log(`APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                lastDetailData = data;
                log('é—®å·è¯¦æƒ…è·å–æˆåŠŸ');
                showResponse('é—®å·è¯¦æƒ…', data);
                
                // åˆ†æé—®å·æ•°æ®ç»“æ„
                analyzeQuestionnaireStructure(data);
                
            } catch (error) {
                log(`è·å–é—®å·è¯¦æƒ…å¤±è´¥: ${error.message}`, 'error');
                showError(error);
            }
        }
        
        async function testQuestionnaireQuestions() {
            try {
                log('å¼€å§‹æµ‹è¯•è·å–é—®é¢˜åˆ—è¡¨...');
                const response = await fetch(`${API_BASE}/questionCreate/questions?questionnaireId=77106636`);
                log(`APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                lastQuestionsData = data;
                log('é—®é¢˜åˆ—è¡¨è·å–æˆåŠŸ');
                showResponse('é—®é¢˜åˆ—è¡¨', data);
                
                // åˆ†æé—®é¢˜æ•°æ®ç»“æ„
                analyzeQuestionsStructure(data);
                
            } catch (error) {
                log(`è·å–é—®é¢˜åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                showError(error);
            }
        }
        
        async function testFullFlow() {
            try {
                log('å¼€å§‹æµ‹è¯•å®Œæ•´æµç¨‹...');
                
                // 1. è·å–é—®å·è¯¦æƒ…
                log('æ­¥éª¤1: è·å–é—®å·è¯¦æƒ…');
                const detailResponse = await fetch(`${API_BASE}/questionCreate/detail/77106636`);
                if (!detailResponse.ok) {
                    throw new Error(`è·å–é—®å·è¯¦æƒ…å¤±è´¥: HTTP ${detailResponse.status}`);
                }
                const detailData = await detailResponse.json();
                lastDetailData = detailData;
                log('é—®å·è¯¦æƒ…è·å–æˆåŠŸ');
                
                // 2. è·å–é—®é¢˜åˆ—è¡¨
                log('æ­¥éª¤2: è·å–é—®é¢˜åˆ—è¡¨');
                const questionsResponse = await fetch(`${API_BASE}/questionCreate/questions?questionnaireId=77106636`);
                if (!questionsResponse.ok) {
                    throw new Error(`è·å–é—®é¢˜åˆ—è¡¨å¤±è´¥: HTTP ${questionsResponse.status}`);
                }
                const questionsData = await questionsResponse.json();
                lastQuestionsData = questionsData;
                log('é—®é¢˜åˆ—è¡¨è·å–æˆåŠŸ');
                
                // 3. æ¨¡æ‹Ÿå‰ç«¯æ•°æ®å¤„ç†
                log('æ­¥éª¤3: æ¨¡æ‹Ÿå‰ç«¯æ•°æ®å¤„ç†');
                const processedData = {
                    questionnaire: detailData.data,
                    questions: questionsData.data
                };
                
                log('æ•°æ®å¤„ç†å®Œæˆ');
                showResponse('å®Œæ•´æµç¨‹æ•°æ®', processedData);
                
                // 4. åˆ†ææ•°æ®ç»“æ„
                log('æ­¥éª¤4: åˆ†ææ•°æ®ç»“æ„');
                analyzeDataStructure();
                
            } catch (error) {
                log(`å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showError(error);
            }
        }
        
        function analyzeQuestionnaireStructure(data) {
            const analysisDiv = document.getElementById('dataAnalysis');
            let analysis = '=== é—®å·è¯¦æƒ…æ•°æ®ç»“æ„åˆ†æ ===\n\n';
            
            if (data.code === 200 && data.data) {
                const questionnaire = data.data;
                analysis += `âœ… é—®å·åŸºæœ¬ä¿¡æ¯:\n`;
                analysis += `  - ID: ${questionnaire.id || 'æœªæ‰¾åˆ°'}\n`;
                analysis += `  - æ ‡é¢˜: ${questionnaire.title || 'æœªæ‰¾åˆ°'}\n`;
                analysis += `  - æè¿°: ${questionnaire.description || 'æœªæ‰¾åˆ°'}\n`;
                analysis += `  - çŠ¶æ€: ${questionnaire.status || 'æœªæ‰¾åˆ°'}\n`;
                analysis += `  - å¼€å§‹æ—¶é—´: ${questionnaire.startDate || 'æœªæ‰¾åˆ°'}\n`;
                analysis += `  - é¢„è®¡ç”¨æ—¶: ${questionnaire.estimatedTime || 'æœªæ‰¾åˆ°'}\n\n`;
                
                analysis += `ğŸ“Š æ•°æ®ç»“æ„æ£€æŸ¥:\n`;
                analysis += `  - æ˜¯å¦æœ‰titleå­—æ®µ: ${questionnaire.hasOwnProperty('title')}\n`;
                analysis += `  - æ˜¯å¦æœ‰contentå­—æ®µ: ${questionnaire.hasOwnProperty('content')}\n`;
                analysis += `  - æ˜¯å¦æœ‰descriptionå­—æ®µ: ${questionnaire.hasOwnProperty('description')}\n`;
                analysis += `  - æ˜¯å¦æœ‰statuså­—æ®µ: ${questionnaire.hasOwnProperty('status')}\n`;
                
                if (questionnaire.status !== 1) {
                    analysis += `\nâš ï¸  è­¦å‘Š: é—®å·çŠ¶æ€ä¸æ˜¯1(å·²å‘å¸ƒ)ï¼Œå½“å‰çŠ¶æ€: ${questionnaire.status}\n`;
                }
            } else {
                analysis += `âŒ é—®å·æ•°æ®æ ¼å¼å¼‚å¸¸:\n`;
                analysis += `  - å“åº”ç : ${data.code}\n`;
                analysis += `  - å“åº”æ¶ˆæ¯: ${data.message}\n`;
                analysis += `  - æ˜¯å¦æœ‰dataå­—æ®µ: ${data.hasOwnProperty('data')}\n`;
            }
            
            analysisDiv.textContent = analysis;
        }
        
        function analyzeQuestionsStructure(data) {
            const analysisDiv = document.getElementById('dataAnalysis');
            let analysis = analysisDiv.textContent + '\n\n=== é—®é¢˜åˆ—è¡¨æ•°æ®ç»“æ„åˆ†æ ===\n\n';
            
            if (data.code === 200 && data.data) {
                const questions = data.data;
                analysis += `âœ… é—®é¢˜åˆ—è¡¨åŸºæœ¬ä¿¡æ¯:\n`;
                analysis += `  - é—®é¢˜æ€»æ•°: ${questions.length}\n`;
                analysis += `  - æ•°æ®ç±»å‹: ${Array.isArray(questions) ? 'æ•°ç»„' : typeof questions}\n\n`;
                
                if (questions.length > 0) {
                    const firstQuestion = questions[0];
                    analysis += `ğŸ“‹ ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç»“æ„:\n`;
                    analysis += `  - é—®é¢˜ID: ${firstQuestion.id || 'æœªæ‰¾åˆ°'}\n`;
                    analysis += `  - é—®é¢˜å†…å®¹: ${firstQuestion.content || 'æœªæ‰¾åˆ°'}\n`;
                    analysis += `  - é—®é¢˜ç±»å‹: ${firstQuestion.questionType || 'æœªæ‰¾åˆ°'}\n`;
                    analysis += `  - æ˜¯å¦å¿…å¡«: ${firstQuestion.isRequired || 'æœªæ‰¾åˆ°'}\n`;
                    analysis += `  - æ’åºå·: ${firstQuestion.sortNum || 'æœªæ‰¾åˆ°'}\n`;
                    analysis += `  - é—®å·ID: ${firstQuestion.questionnaireId || 'æœªæ‰¾åˆ°'}\n\n`;
                    
                    analysis += `ğŸ” å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥:\n`;
                    analysis += `  - æ˜¯å¦æœ‰contentå­—æ®µ: ${firstQuestion.hasOwnProperty('content')}\n`;
                    analysis += `  - æ˜¯å¦æœ‰titleå­—æ®µ: ${firstQuestion.hasOwnProperty('title')}\n`;
                    analysis += `  - æ˜¯å¦æœ‰questionTypeå­—æ®µ: ${firstQuestion.hasOwnProperty('questionType')}\n`;
                    analysis += `  - æ˜¯å¦æœ‰isRequiredå­—æ®µ: ${firstQuestion.hasOwnProperty('isRequired')}\n`;
                    analysis += `  - æ˜¯å¦æœ‰optionså­—æ®µ: ${firstQuestion.hasOwnProperty('options')}\n`;
                    
                    if (firstQuestion.options && firstQuestion.options.length > 0) {
                        analysis += `\nğŸ“ é€‰é¡¹ä¿¡æ¯:\n`;
                        analysis += `  - é€‰é¡¹æ•°é‡: ${firstQuestion.options.length}\n`;
                        const firstOption = firstQuestion.options[0];
                        analysis += `  - ç¬¬ä¸€ä¸ªé€‰é¡¹ID: ${firstOption.id || 'æœªæ‰¾åˆ°'}\n`;
                        analysis += `  - ç¬¬ä¸€ä¸ªé€‰é¡¹å†…å®¹: ${firstOption.optionContent || firstOption.content || 'æœªæ‰¾åˆ°'}\n`;
                    } else {
                        analysis += `\nâš ï¸  è­¦å‘Š: ç¬¬ä¸€ä¸ªé—®é¢˜æ²¡æœ‰é€‰é¡¹æ•°æ®\n`;
                    }
                } else {
                    analysis += `âš ï¸  è­¦å‘Š: é—®é¢˜åˆ—è¡¨ä¸ºç©º\n`;
                }
            } else {
                analysis += `âŒ é—®é¢˜æ•°æ®æ ¼å¼å¼‚å¸¸:\n`;
                analysis += `  - å“åº”ç : ${data.code}\n`;
                analysis += `  - å“åº”æ¶ˆæ¯: ${data.message}\n`;
                analysis += `  - æ˜¯å¦æœ‰dataå­—æ®µ: ${data.hasOwnProperty('data')}\n`;
            }
            
            analysisDiv.textContent = analysis;
        }
        
        function analyzeDataStructure() {
            if (!lastDetailData || !lastQuestionsData) {
                log('è¯·å…ˆè·å–é—®å·è¯¦æƒ…å’Œé—®é¢˜åˆ—è¡¨æ•°æ®', 'warning');
                return;
            }
            
            const analysisDiv = document.getElementById('dataAnalysis');
            let analysis = analysisDiv.textContent + '\n\n=== ç»¼åˆæ•°æ®åˆ†æ ===\n\n';
            
            // æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            const questionnaire = lastDetailData.data;
            const questions = lastQuestionsData.data;
            
            analysis += `ğŸ” æ•°æ®å®Œæ•´æ€§æ£€æŸ¥:\n`;
            analysis += `  - é—®å·æ•°æ®: ${questionnaire ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
            analysis += `  - é—®é¢˜æ•°æ®: ${questions ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
            analysis += `  - é—®é¢˜æ•°é‡: ${questions ? questions.length : 0}\n\n`;
            
            // æ£€æŸ¥å‰ç«¯æœŸæœ›çš„å­—æ®µ
            if (questionnaire) {
                analysis += `ğŸ“‹ å‰ç«¯æœŸæœ›çš„é—®å·å­—æ®µ:\n`;
                analysis += `  - title: ${questionnaire.title ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - description: ${questionnaire.description ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - status: ${questionnaire.status ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - startDate: ${questionnaire.startDate ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - estimatedTime: ${questionnaire.estimatedTime ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n\n`;
            }
            
            if (questions && questions.length > 0) {
                analysis += `ğŸ“‹ å‰ç«¯æœŸæœ›çš„é—®é¢˜å­—æ®µ:\n`;
                const firstQuestion = questions[0];
                analysis += `  - content: ${firstQuestion.content ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - questionType: ${firstQuestion.questionType ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - isRequired: ${firstQuestion.hasOwnProperty('isRequired') ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                analysis += `  - options: ${firstQuestion.options ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                
                if (firstQuestion.options && firstQuestion.options.length > 0) {
                    const firstOption = firstQuestion.options[0];
                    analysis += `  - optionContent: ${firstOption.optionContent ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                    analysis += `  - content: ${firstOption.content ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n`;
                }
            }
            
            // æä¾›ä¿®å¤å»ºè®®
            analysis += `\nğŸ’¡ ä¿®å¤å»ºè®®:\n`;
            if (questionnaire && !questionnaire.title) {
                analysis += `  - é—®å·ç¼ºå°‘titleå­—æ®µï¼Œå‰ç«¯æ— æ³•æ˜¾ç¤ºæ ‡é¢˜\n`;
            }
            if (questions && questions.length > 0 && !questions[0].content) {
                analysis += `  - é—®é¢˜ç¼ºå°‘contentå­—æ®µï¼Œå‰ç«¯æ— æ³•æ˜¾ç¤ºé—®é¢˜å†…å®¹\n`;
            }
            if (questions && questions.length > 0 && questions[0].options && questions[0].options.length > 0) {
                const firstOption = questions[0].options[0];
                if (!firstOption.optionContent && !firstOption.content) {
                    analysis += `  - é€‰é¡¹ç¼ºå°‘å†…å®¹å­—æ®µï¼Œå‰ç«¯æ— æ³•æ˜¾ç¤ºé€‰é¡¹\n`;
                }
            }
            
            analysisDiv.textContent = analysis;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            log('è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•');
            log('å»ºè®®æŒ‰é¡ºåºæ‰§è¡Œï¼š1.è·å–é—®å·è¯¦æƒ… 2.è·å–é—®é¢˜åˆ—è¡¨ 3.åˆ†ææ•°æ®ç»“æ„');
        };
    </script>
</body>
</html>
