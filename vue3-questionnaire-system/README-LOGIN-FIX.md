# 登录功能修复说明

## 问题描述

1. **登录成功后跳转不到首页**：用户登录成功后无法正确跳转到目标页面
2. **主页键功能错误**：首页的主页键直接退出登录，而不是返回首页

## 修复内容

### 1. 修复登录跳转问题

#### Login.vue 修复
- 简化了登录成功后的跳转逻辑
- 增加了等待时间确保store数据更新完成
- 优化了错误处理和备选跳转方案

#### 路由配置修复
- 将根路径 `/` 重定向改为 `/home` 而不是 `/login`
- 确保登录成功后跳转路径正确

#### 用户Store修复
- 增加了详细的调试日志
- 确保token和用户信息正确保存
- 优化了权限设置逻辑

### 2. 修复主页键功能

#### Home.vue 修复
- 将导航栏中的"首页"链接改为可点击的
- 在用户下拉菜单中添加"返回首页"选项
- 保留"退出登录"选项，但不再是主页键功能

### 3. 其他优化

#### App.vue 修复
- 移除了不存在的 `tempLogin()` 方法调用
- 优化了用户状态初始化逻辑

## 测试方法

1. 使用测试页面 `test-login-fix.html` 进行功能验证
2. 测试账号：admin / admin123 (角色1 - 教师/管理员)
3. 验证登录成功后能正确跳转到首页
4. 验证首页的主页键能正确返回首页

## 修复后的功能流程

1. 用户输入用户名密码
2. 点击登录按钮
3. 后端验证成功返回用户信息
4. 前端保存token和用户信息到store和localStorage
5. 根据用户角色确定跳转目标：
   - 角色1 (教师/管理员) → `/home` (管理端首页)
   - 角色0 (普通用户) → `/ask-user` (用户端页面)
6. 使用Vue Router进行页面跳转
7. 如果路由跳转失败，使用window.location作为备选方案

## 注意事项

- 确保后端返回的用户角色信息正确
- 确保前端路由配置正确
- 确保用户权限验证逻辑正确
- 如果仍有问题，检查浏览器控制台的错误信息
